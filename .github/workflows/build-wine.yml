name: wine

on:
    push:
      branches: [ main ]
      paths:
        - 'wine/**'
        - '.github/workflows/build-wine.yml'
    workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
  
    steps:
      - uses: actions/checkout@v3

      - name: Run a multi-line script
        run: |
          sudo apt-get -qq purge -y --auto-remove man-db
          sudo dpkg --add-architecture i386
          sudo apt-get -qq update
          sudo apt-get -qq install -y gcc-multilib libasound2-dev:i386 libgsm1-dev:i386 libjpeg8-dev:i386 liblcms2-dev:i386 libldap2-dev:i386 libmpg123-dev:i386 libopenal-dev:i386 libv4l-dev:i386 libx11-dev:i386 libxinerama-dev:i386 libxml2-dev:i386 zlib1g-dev:i386 libcapi20-dev:i386 libcups2:i386 libdbus-1-3:i386 libfontconfig:i386 libfreetype6:i386 libglu1-mesa:i386 libgnutls26:i386 libgphoto2-2:i386 libncurses5:i386 libosmesa6:i386 libsane:i386 libxcomposite1:i386 libxcursor1:i386 libxi6:i386 libxrandr2:i386 libxslt1.1:i386 ocl-icd-libopencl1:i386
          wget -nc -nv https://github.com/wine-mirror/wine/archive/refs/tags/wine-7.10.tar.gz
          tar xf wine-7.10.tar.gz --strip-components 1
          mkdir build && cd build
          ../configure
          make
          cd ..
          tar -Jcf wine-7.10-amd64-build.tar.xz build
      - name: Store built files
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: build
          path: wine-7.10-amd64-build.tar.xz
